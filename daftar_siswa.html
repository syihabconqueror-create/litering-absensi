<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daftar Siswa - Litering</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      padding: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #2c3e50;
      color: white;
      cursor: pointer;
    }

    th:hover {
      background-color: #34495e;
    }

    tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    button {
      background-color: #3498db;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      padding: 8px 14px;
      margin-right: 10px;
    }

    button:hover {
      background-color: #2980b9;
    }

    .controls {
      margin-bottom: 15px;
    }
  </style>
</head>

<body>
  <!-- üîπ NAVBAR -->
  <div id="navbar"></div>
  <script>
    fetch("navbar.html")
      .then(res => res.text())
      .then(html => document.getElementById("navbar").innerHTML = html);
  </script>
  
  <h1>üìã Daftar Siswa Litering</h1>

  <div class="controls">
    <button onclick="loadData()">üîÑ Refresh Data</button>
    <button onclick="downloadCSV()">‚¨áÔ∏è Download CSV</button>
  </div>

  <table>
    <thead>
      <tr>
        <th onclick="sortTable('id')">ID ‚¨ç</th>
        <th onclick="sortTable('nama')">Nama ‚¨ç</th>
        <th onclick="sortTable('kelas')">Kelas ‚¨ç</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="siswaTable">
      <tr><td colspan="4" style="text-align:center;">Memuat data...</td></tr>
    </tbody>
  </table>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    // üî• Konfigurasi Firebase (sama seperti index.html)
    const firebaseConfig = {
      apiKey: "AIzaSyDGVM5T-us2R19M-zLmVbMh-NUgjg3Af68",
      authDomain: "litering-absensi.firebaseapp.com",
      databaseURL: "https://litering-absensi-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "litering-absensi",
      storageBucket: "litering-absensi.firebasestorage.app",
      messagingSenderId: "529191002867",
      appId: "1:529191002867:web:d751dddb59e230f08acd86",
      measurementId: "G-VGRF516G18"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let siswaData = [];  // data global untuk sorting & download

    // üîç Ambil data dari Firebase
    function loadData() {
      const tbody = document.getElementById("siswaTable");
      tbody.innerHTML = "<tr><td colspan='4' style='text-align:center;'>Memuat data...</td></tr>";

      db.ref("siswa").once("value").then(snapshot => {
        siswaData = [];
        tbody.innerHTML = "";
        if (!snapshot.exists()) {
          tbody.innerHTML = "<tr><td colspan='4' style='text-align:center;'>Belum ada data siswa.</td></tr>";
          return;
        }

        snapshot.forEach(child => {
          const s = child.val();
          siswaData.push({
            id: s.id || child.key,
            nama: s.nama || '-',
            kelas: s.kelas || '-',
            status: s.status || '-'
          });
        });

        renderTable(siswaData);
      });
    }

    // üîÑ Tampilkan data ke tabel
    function renderTable(data) {
      const tbody = document.getElementById("siswaTable");
      tbody.innerHTML = "";
      data.forEach(s => {
        tbody.innerHTML += `
          <tr>
            <td>${s.id}</td>
            <td>${s.nama}</td>
            <td>${s.kelas}</td>
            <td>${s.status}</td>
          </tr>`;
      });
    }

    // ‚ÜïÔ∏è Fungsi sorting
    let sortDirection = 1; // 1 = ASC, -1 = DESC
    function sortTable(key) {
      sortDirection *= -1;
      siswaData.sort((a, b) => {
        const valA = (a[key] || "").toString().toLowerCase();
        const valB = (b[key] || "").toString().toLowerCase();
        if (valA < valB) return -1 * sortDirection;
        if (valA > valB) return 1 * sortDirection;
        return 0;
      });
      renderTable(siswaData);
    }

    // üíæ Download CSV
    function downloadCSV() {
      if (!siswaData.length) {
        alert("Data belum dimuat!");
        return;
      }

      const header = ["ID", "Nama", "Kelas", "Status"];
      const rows = siswaData.map(s => [s.id, s.nama, s.kelas, s.status]);

      let csvContent = "data:text/csv;charset=utf-8,"
        + header.join(",") + "\n"
        + rows.map(e => e.join(",")).join("\n");

      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "daftar_siswa.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // üöÄ Jalankan saat halaman dibuka
    window.onload = loadData;
  </script>

</body>
</html>
